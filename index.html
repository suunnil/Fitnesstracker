<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Daily Fitness & Posture Tracker</title>
<meta name="description" content="Simple daily tracker for meals, protein, workouts, posture and walks. Works on GitHub Pages (static, localStorage)." />
<style>
  :root{
    --bg:#0f1720; --card:#0b1220; --muted:#98a2b3; --accent:#22c55e; --accent2:#60a5fa;
    --glass: rgba(255,255,255,0.03);
    font-family: Inter, ui-sans-serif, system-ui, -apple-system, "Segoe UI", Roboto, "Helvetica Neue", Arial;
  }
  *{box-sizing:border-box}
  body{margin:0;background:linear-gradient(180deg,#071021 0%, #071829 100%);color:#e6eef6;line-height:1.35}
  .wrap{max-width:980px;margin:18px auto;padding:18px}
  header{display:flex;gap:12px;align-items:center;justify-content:space-between;flex-wrap:wrap}
  h1{font-size:20px;margin:0}
  p.lead{margin:0;color:var(--muted);font-size:13px}
  .card{background:var(--card);border-radius:10px;padding:14px;margin-top:14px;box-shadow:0 6px 18px rgba(2,6,23,0.6)}
  form.row{display:grid;grid-template-columns:1fr 1fr;gap:10px}
  @media (max-width:720px){ form.row{grid-template-columns:1fr} }
  label{display:block;font-size:12px;color:var(--muted);margin-bottom:6px}
  input[type="text"], input[type="number"], input[type="date"], select, textarea{
    width:100%;padding:10px;border-radius:8px;border:1px solid rgba(255,255,255,0.06);background:var(--glass);color:inherit;font-size:14px;
  }
  textarea{min-height:72px;resize:vertical}
  button{background:var(--accent);color:#012; border:none;padding:10px 12px;border-radius:8px;cursor:pointer;font-weight:600}
  button.secondary{background:transparent;border:1px solid rgba(255,255,255,0.06);color:var(--muted);font-weight:600}
  .controls{display:flex;gap:8px;flex-wrap:wrap;align-items:center}
  .entry-list{max-height:420px;overflow:auto}
  .entry{padding:10px;border-radius:8px;background:rgba(255,255,255,0.03);margin-bottom:8px;display:flex;justify-content:space-between;gap:8px;align-items:flex-start}
  .meta{font-size:13px;color:var(--muted)}
  .pill{display:inline-block;padding:6px 8px;border-radius:999px;background:rgba(255,255,255,0.05);font-weight:600;color:var(--muted);font-size:12px;margin-left:6px}
  .summary{display:flex;gap:10px;flex-wrap:wrap}
  .summary .s{background:rgba(255,255,255,0.05);padding:12px;border-radius:8px;min-width:120px}
  .small{font-size:13px;color:var(--muted)}
  .smallBtn{padding:8px 10px;border-radius:8px;background:transparent;border:1px solid rgba(255,255,255,0.06);color:var(--muted);cursor:pointer}
  input::-webkit-inner-spin-button { -webkit-appearance: none; margin: 0; }
  table{width:100%}
  td, th{padding:6px 8px}
  .accentOn{background:var(--accent);color:#012;border-radius:8px}
  footer{margin-top:20px;color:var(--muted);font-size:13px;text-align:center}
</style>
</head>
<body>
  <div class="wrap">
    <header>
      <div>
        <h1>Fitness & Posture Tracker</h1>
        <p class="lead">Track workouts, meals, posture, walks & protein — data stored locally.</p>
      </div>

      <div class="controls">
        <button id="btnAddSample">Add Sample</button>
        <button id="btnExport" class="secondary">Export JSON</button>
        <button id="btnCSV" class="secondary">Export CSV</button>
        <input id="fileInput" type="file" accept="application/json" style="display:none" />
        <button id="btnImport" class="secondary">Import JSON</button>

        <!-- QUICK ACTIONS -->
        <div id="quickActions" style="display:flex;gap:8px;align-items:center;margin-left:8px">
          <button id="btnQuickWorkout" title="Mark workout done">Workout ✔️</button>
          <button id="btnQuickPosture" title="Mark posture done">Posture ✔️</button>
          <button id="btnQuickWalk" title="Mark walk done">Walk ✔️</button>
          <input id="quickProteinInput" type="number" min="0" placeholder="Prot g" style="width:74px;padding:8px;border-radius:8px;border:1px solid rgba(255,255,255,0.06);background:transparent;color:inherit" />
          <button id="btnQuickProtein" title="Add protein">Add Prot</button>
        </div>
      </div>
    </header>

    <div class="card" role="region" aria-label="Entry form">
      <form id="entryForm" class="row" autocomplete="off">
        <div>
          <label for="date">Date</label>
          <input id="date" type="date" required />
        </div>
        <div>
          <label for="workout">Workout (type)</label>
          <select id="workout">
            <option value="">-- none / rest --</option>
            <option>Push</option><option>Pull</option><option>Legs+Core</option><option>Cardio</option><option>Rest</option>
          </select>
        </div>

        <div>
          <label for="breakfast">Breakfast (brief)</label>
          <input id="breakfast" type="text" placeholder="e.g., sprouts + egg" />
        </div>
        <div>
          <label for="lunch">Lunch (brief)</label>
          <input id="lunch" type="text" placeholder="e.g., sambar rice" />
        </div>

        <div>
          <label for="snack">Snack / Pre-workout</label>
          <input id="snack" type="text" placeholder="e.g., sandwich" />
        </div>
        <div>
          <label for="dinner">Dinner (brief)</label>
          <input id="dinner" type="text" placeholder="e.g., roti + veg" />
        </div>

        <div>
          <label for="protein">Estimated Protein (g)</label>
          <input id="protein" type="number" min="0" step="1" placeholder="e.g., 80" />
        </div>
        <div>
          <label for="walk">Walk after dinner</label>
          <select id="walk">
            <option value="no">No</option><option value="yes">Yes</option>
          </select>
        </div>

        <div>
          <label for="posture">Posture routine done</label>
          <select id="posture">
            <option value="no">No</option><option value="yes">Yes</option>
          </select>
        </div>
        <div>
          <label for="notes">Notes</label>
          <input id="notes" type="text" placeholder="Optional notes" />
        </div>

        <div style="grid-column:1 / -1;display:flex;gap:8px;align-items:center;margin-top:6px">
          <button id="saveBtn" type="submit">Save Entry</button>
          <button id="clearBtn" type="button" class="secondary">Clear Form</button>
          <div style="margin-left:auto" class="small">Data saved in your browser. Export regularly for backup.</div>
        </div>
      </form>
    </div>

    <!-- ===== STEP 1: DAILY DETAIL PANEL (paste AFTER form) ===== -->
    <div class="card" style="margin-top:12px">
      <strong>Daily Quick Log & Nutrition</strong>

      <!-- Workouts Mon-Sat -->
      <div style="margin-top:10px">
        <label class="meta">Workout days (tap when done):</label>
        <div style="display:flex;gap:8px;flex-wrap:wrap;margin-top:6px">
          <button type="button" class="smallBtn" data-day="Mon" id="dayMon">Mon</button>
          <button type="button" class="smallBtn" data-day="Tue" id="dayTue">Tue</button>
          <button type="button" class="smallBtn" data-day="Wed" id="dayWed">Wed</button>
          <button type="button" class="smallBtn" data-day="Thu" id="dayThu">Thu</button>
          <button type="button" class="smallBtn" data-day="Fri" id="dayFri">Fri</button>
          <button type="button" class="smallBtn" data-day="Sat" id="daySat">Sat</button>
        </div>
        <div class="small" style="margin-top:6px">Tap again to clear a day. These save to today's entry.</div>
      </div>

      <!-- Posture images -->
      <div style="margin-top:10px">
        <label class="meta">Posture photos (front / side) — upload small photos (keep <500KB)</label>
        <div style="display:flex;gap:8px;flex-wrap:wrap;margin-top:8px">
          <input id="postureFile1" type="file" accept="image/*" />
          <input id="postureFile2" type="file" accept="image/*" />
        </div>
        <div id="posturePreview" style="display:flex;gap:8px;margin-top:8px"></div>
      </div>

      <!-- Food table -->
      <div style="margin-top:12px">
        <label class="meta">Food (enter grams) — add rows</label>
        <table id="foodTable" style="width:100%;margin-top:8px;border-collapse:collapse">
          <thead style="text-align:left;color:var(--muted);font-size:13px">
            <tr><th style="width:36%">Item</th><th style="width:18%">g</th><th style="width:18%">kcal/100g</th><th style="width:18%">prot/100g (g)</th><th></th></tr>
          </thead>
          <tbody></tbody>
        </table>
        <div style="display:flex;gap:8px;margin-top:8px">
          <button id="addFoodRow" class="secondary">Add Food</button>
          <button id="addPreset" class="secondary">Add Preset (rice/egg/moong)</button>
          <div style="margin-left:auto" class="meta">Totals: <span id="totKcal">0</span> kcal • <span id="totProt">0</span> g protein</div>
        </div>
      </div>

      <!-- Water and evaluate -->
      <div style="margin-top:12px;display:flex;gap:8px;align-items:center;flex-wrap:wrap">
        <div>
          <label class="meta">Water (ml)</label>
          <input id="waterMl" type="number" min="0" placeholder="3000" style="width:120px;padding:8px;border-radius:8px" />
        </div>

        <div>
          <label class="meta">Protein target (g)</label>
          <input id="proteinTarget" type="number" min="0" placeholder="100" style="width:120px;padding:8px;border-radius:8px" />
        </div>

        <div>
          <label class="meta">Calorie target (min - max)</label>
          <input id="calMin" type="number" placeholder="1600" style="width:90px;padding:8px;border-radius:8px" />
          <input id="calMax" type="number" placeholder="2200" style="width:90px;padding:8px;border-radius:8px;margin-left:6px" />
        </div>

        <div style="margin-left:auto;display:flex;gap:8px">
          <button id="btnEvaluate" class="secondary">Evaluate Day</button>
          <button id="btnSaveDaily" class="secondary">Save Daily Summary</button>
        </div>
      </div>

      <div id="dailyResult" style="margin-top:10px;font-size:14px"></div>
    </div>
    <!-- ===== end daily detail panel ===== -->

    <div class="grid2" style="display:grid;grid-template-columns:1fr 380px;gap:12px;margin-top:12px">
      <div class="card">
        <div style="display:flex;justify-content:space-between;align-items:center">
          <strong>Entries</strong>
          <div class="small">Showing <span id="count">0</span></div>
        </div>
        <div style="margin-top:10px;display:flex;gap:8px;align-items:center">
          <input id="filterDate" type="date" />
          <input id="q" type="text" placeholder="Search meals / notes" style="flex:1" />
          <select id="sortBy"><option value="dateDesc">Newest</option><option value="dateAsc">Oldest</option></select>
        </div>

        <div class="entry-list" id="entryList" aria-live="polite" style="margin-top:10px"></div>
      </div>

      <aside class="card">
        <strong>Summary</strong>
        <div style="margin-top:10px" id="summaryArea">
          <div class="summary">
            <div class="s"><div class="meta small">Total days logged</div><div id="totalDays">0</div></div>
            <div class="s"><div class="meta small">Avg Protein</div><div id="avgProtein">0 g</div></div>
            <div class="s"><div class="meta small">Posture done %</div><div id="posturePct">0%</div></div>
            <div class="s"><div class="meta small">Walks %</div><div id="walkPct">0%</div></div>
          </div>
        </div>

        <div style="margin-top:12px">
          <strong>Quick actions</strong>
          <div style="margin-top:8px;display:flex;gap:8px;align-items:center">
            <button id="btnToday" class="secondary">Load Today</button>
            <button id="btnExportOne" class="secondary">Export CSV (visible)</button>
            <button id="btnDeleteAll" class="secondary">Delete All</button>
          </div>
          <div class="small" style="margin-top:8px">Tip: Export JSON regularly. Use Import to restore on new device.</div>
        </div>
      </aside>
    </div>

    <footer>
      Made for you • Data stored only on your browser (localStorage). To host: create a GitHub repo, push this file, enable Pages.
    </footer>
  </div>

<script>
(function(){
  // storage key
  const KEY = 'fitpost_entries_v2';
  const form = document.getElementById('entryForm');
  const entryList = document.getElementById('entryList');
  const countEl = document.getElementById('count');
  const totalDays = document.getElementById('totalDays');
  const avgProtein = document.getElementById('avgProtein');
  const posturePct = document.getElementById('posturePct');
  const walkPct = document.getElementById('walkPct');
  const q = document.getElementById('q');
  const filterDate = document.getElementById('filterDate');
  const sortBy = document.getElementById('sortBy');
  const fileInput = document.getElementById('fileInput');

  // util
  function uid(){ return Date.now().toString(36) + Math.random().toString(36).slice(2,7) }
  function todayISO(){ return new Date().toISOString().slice(0,10); }

  // load/save
  function load(){
    const raw = localStorage.getItem(KEY);
    if(!raw) return [];
    try{ return JSON.parse(raw) } catch(e){ console.warn('corrupt data', e); return [] }
  }
  function saveAll(arr){ localStorage.setItem(KEY, JSON.stringify(arr)); render() }

  // ---------- Quick helpers for today's entry ----------
  function getOrCreateTodayEntry(){
    const arr = load();
    const today = todayISO();
    let entry = arr.find(x => x.date === today);
    if(!entry){
      entry = {
        id: uid(),
        date: today,
        workout: '',
        breakfast: '',
        lunch: '',
        snack: '',
        dinner: '',
        protein: 0,
        walk: false,
        posture: false,
        notes: '',
        workoutDays: {},
        postureImgs: {},
        calories: 0,
        waterMl: 0,
        updatedAt: new Date().toISOString()
      };
      arr.push(entry);
      saveAll(arr);
    }
    return entry;
  }

  function updateToday(patch){
    const arr = load();
    const today = todayISO();
    let idx = arr.findIndex(x => x.date === today);
    if(idx === -1){
      const newEntry = Object.assign({
        id: uid(),
        date: today,
        workout: '',
        breakfast: '',
        lunch: '',
        snack: '',
        dinner: '',
        protein: 0,
        walk: false,
        posture: false,
        notes: '',
        workoutDays: {},
        postureImgs: {},
        calories: 0,
        waterMl: 0,
        updatedAt: new Date().toISOString()
      }, patch);
      arr.push(newEntry);
    } else {
      arr[idx] = Object.assign({}, arr[idx], patch, { updatedAt: new Date().toISOString() });
    }
    saveAll(arr);
    render();
  }

  // ---------- Quick buttons (header) ----------
  document.getElementById('btnQuickWorkout').addEventListener('click', function(){
    const e = getOrCreateTodayEntry();
    const newWorkout = e.workout && e.workout !== 'Rest' ? '' : 'Push';
    updateToday({ workout: newWorkout });
    toastQuick('Workout toggled: ' + (newWorkout || 'cleared'));
  });

  document.getElementById('btnQuickPosture').addEventListener('click', function(){
    const e = getOrCreateTodayEntry();
    const newVal = !e.posture;
    updateToday({ posture: newVal });
    toastQuick('Posture: ' + (newVal ? 'done' : 'cleared'));
  });

  document.getElementById('btnQuickWalk').addEventListener('click', function(){
    const e = getOrCreateTodayEntry();
    const newVal = !e.walk;
    updateToday({ walk: newVal });
    toastQuick('Walk: ' + (newVal ? 'done' : 'cleared'));
  });

  document.getElementById('btnQuickProtein').addEventListener('click', function(){
    const input = document.getElementById('quickProteinInput');
    let add = Number(input.value || 0);
    if(!add || add <= 0){ input.focus(); return alert('Enter protein grams to add'); }
    const e = getOrCreateTodayEntry();
    const newProtein = (Number(e.protein || 0) + add);
    updateToday({ protein: newProtein });
    input.value = '';
    toastQuick('Protein updated: ' + newProtein + ' g');
  });

  // ---------- Toast message ----------
  function toastQuick(msg){
    let t = document.getElementById('quickToast');
    if(!t){
      t = document.createElement('div');
      t.id = 'quickToast';
      t.style.position = 'fixed';
      t.style.right = '14px';
      t.style.bottom = '60px';
      t.style.padding = '10px 12px';
      t.style.background = 'rgba(0,0,0,0.6)';
      t.style.border = '1px solid rgba(255,255,255,0.06)';
      t.style.borderRadius = '8px';
      t.style.color = '#dfeef8';
      t.style.zIndex = 9999;
      document.body.appendChild(t);
    }
    t.textContent = msg;
    t.style.opacity = '1';
    clearTimeout(t._t);
    t._t = setTimeout(()=>{ t.style.opacity = '0'; }, 2000);
  }

  // ---------- Form handling ----------
  function getFormData(){
    return {
      id: form.dataset.editId || uid(),
      date: document.getElementById('date').value || todayISO(),
      workout: document.getElementById('workout').value || '',
      breakfast: document.getElementById('breakfast').value || '',
      lunch: document.getElementById('lunch').value || '',
      snack: document.getElementById('snack').value || '',
      dinner: document.getElementById('dinner').value || '',
      protein: Number(document.getElementById('protein').value || 0),
      walk: document.getElementById('walk').value === 'yes',
      posture: document.getElementById('posture').value === 'yes',
      notes: document.getElementById('notes').value || '',
      workoutDays: (getOrCreateTodayEntry().workoutDays || {}),
      postureImgs: (getOrCreateTodayEntry().postureImgs || {}),
      calories: (getOrCreateTodayEntry().calories || 0),
      waterMl: (getOrCreateTodayEntry().waterMl || 0),
      updatedAt: new Date().toISOString()
    };
  }

  form.addEventListener('submit', function(e){
    e.preventDefault();
    const all = load();
    const data = getFormData();
    const idx = all.findIndex(x => x.id === data.id);
    if(idx >= 0) all[idx] = data;
    else all.push(data);
    saveAll(all);
    clearForm();
    toastQuick('Entry saved');
  });

  function clearForm(){
    delete form.dataset.editId;
    form.reset();
    document.getElementById('date').value = todayISO();
  }
  document.getElementById('clearBtn').addEventListener('click', clearForm);

  // ---------- Render entries ----------
  function escapeHtml(s){ return String(s).replace(/[&<>"']/g, c=> ({'&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;',"'":'&#39;'}[c])) }

  function render(){
    const items = load();
    const qv = (q && q.value.trim().toLowerCase()) || '';
    const fd = (filterDate && filterDate.value) || '';

    let filtered = items.slice();
    if(fd) filtered = filtered.filter(x => x.date === fd);
    if(qv) filtered = filtered.filter(x => ((x.breakfast || '') + (x.lunch||'') + (x.snack||'') + (x.dinner||'') + (x.notes||'')).toLowerCase().includes(qv));
    if(sortBy.value === 'dateDesc') filtered.sort((a,b)=> b.date.localeCompare(a.date));
    else filtered.sort((a,b)=> a.date.localeCompare(b.date));

    entryList.innerHTML = '';
    filtered.forEach(item=>{
      const el = document.createElement('div');
      el.className = 'entry';
      el.innerHTML = `
        <div style="flex:1">
          <div style="display:flex;align-items:center;gap:8px">
            <strong>${item.date}</strong>
            <span class="pill">${item.workout || 'No workout'}</span>
            <span class="meta" style="margin-left:auto">${item.protein || 0} g protein</span>
          </div>
          <div class="meta" style="margin-top:6px">
            <div><strong>B:</strong> ${escapeHtml(item.breakfast||'-')}</div>
            <div><strong>L:</strong> ${escapeHtml(item.lunch||'-')}</div>
            <div><strong>S:</strong> ${escapeHtml(item.snack||'-')} <strong style="margin-left:8px">D:</strong> ${escapeHtml(item.dinner||'-')}</div>
            ${ item.notes ? `<div style="margin-top:6px" class="small">Notes: ${escapeHtml(item.notes)}</div>` : '' }
            ${ item.workoutDays ? `<div style="margin-top:6px" class="small">Workout days: ${Object.keys(item.workoutDays||{}).filter(k=>item.workoutDays[k]).join(', ')}</div>` : '' }
            ${ item.calories ? `<div style="margin-top:6px" class="small">Calories: ${item.calories} kcal • Water: ${item.waterMl || 0} ml</div>` : '' }
          </div>
        </div>
        <div class="actions" style="display:flex;flex-direction:column;gap:6px">
          <button class="secondary" data-action="edit" data-id="${item.id}">Edit</button>
          <button class="secondary" data-action="delete" data-id="${item.id}">Delete</button>
        </div>
      `;
      entryList.appendChild(el);
    });

    countEl.textContent = filtered.length;
    // summary
    const total = items.length;
    const avgP = total ? Math.round((items.reduce((s,i)=>s + (i.protein||0),0) / total) * 10)/10 : 0;
    const postureDone = total ? Math.round((items.filter(i=>i.posture).length/total)*100) : 0;
    const walks = total ? Math.round((items.filter(i=>i.walk).length/total)*100) : 0;
    totalDays.textContent = total;
    avgProtein.textContent = (avgP ? avgP + ' g' : '0 g');
    posturePct.textContent = postureDone + '%';
    walkPct.textContent = walks + '%';

    // show posture previews for today
    showPosturePreviews();
  }

  entryList.addEventListener('click', function(e){
    const btn = e.target.closest('button');
    if(!btn) return;
    const id = btn.dataset.id;
    const action = btn.dataset.action;
    if(action === 'edit'){
      const items = load();
      const obj = items.find(x=>x.id === id);
      if(obj){
        form.dataset.editId = obj.id;
        document.getElementById('date').value = obj.date;
        document.getElementById('workout').value = obj.workout || '';
        document.getElementById('breakfast').value = obj.breakfast || '';
        document.getElementById('lunch').value = obj.lunch || '';
        document.getElementById('snack').value = obj.snack || '';
        document.getElementById('dinner').value = obj.dinner || '';
        document.getElementById('protein').value = obj.protein || '';
        document.getElementById('walk').value = obj.walk ? 'yes' : 'no';
        document.getElementById('posture').value = obj.posture ? 'yes' : 'no';
        document.getElementById('notes').value = obj.notes || '';
        // load daily details if present to UI
        (obj.calories !== undefined) && (document.getElementById('totKcal').textContent = obj.calories || 0);
        (obj.protein !== undefined) && (document.getElementById('totProt').textContent = obj.protein || 0);
        (obj.waterMl !== undefined) && (document.getElementById('waterMl').value = obj.waterMl || '');
        window.scrollTo({top:0,behavior:'smooth'});
      }
    }
    else if(action === 'delete'){
      if(!confirm('Delete entry?')) return;
      const items = load().filter(x=>x.id !== id);
      saveAll(items);
    }
  });

  // Filters
  q.addEventListener('input', render);
  filterDate.addEventListener('change', render);
  sortBy.addEventListener('change', render);

  // Export / Import
  document.getElementById('btnExport').addEventListener('click', function(){
    const data = load();
    const blob = new Blob([JSON.stringify(data, null, 2)], {type:'application/json'});
    const url = URL.createObjectURL(blob);
    const a = document.createElement('a'); a.href = url; a.download = 'fitpost_backup_' + (new Date().toISOString().slice(0,10)) + '.json'; a.click();
    URL.revokeObjectURL(url);
  });

  document.getElementById('btnCSV').addEventListener('click', function(){
    const items = load();
    if(!items.length){ alert('No data to export'); return; }
    const headers = ['date','workout','breakfast','lunch','snack','dinner','protein','walk','posture','notes'];
    const rows = [headers.join(',')].concat(items.map(i => headers.map(h=>{
      let v = i[h];
      if(typeof v === 'boolean') v = v ? 'yes' : 'no';
      return '"' + String(v || '').replace(/"/g, '""') + '"';
    }).join(',')));
    const blob = new Blob([rows.join('\n')], {type:'text/csv'});
    const url = URL.createObjectURL(blob);
    const a = document.createElement('a'); a.href = url; a.download = 'fitpost_' + (new Date().toISOString().slice(0,10)) + '.csv'; a.click();
    URL.revokeObjectURL(url);
  });

  document.getElementById('btnImport').addEventListener('click', function(){ fileInput.click(); });
  fileInput.addEventListener('change', function(ev){
    const f = ev.target.files[0]; if(!f) return;
    const reader = new FileReader();
    reader.onload = function(){ try{
      const parsed = JSON.parse(reader.result);
      if(!Array.isArray(parsed)) throw new Error('Invalid file');
      const cur = load();
      parsed.forEach(item => {
        if(!item.id) item.id = uid();
        if(!cur.find(x=>x.id === item.id)) cur.push(item);
      });
      saveAll(cur);
      fileInput.value = '';
      alert('Import complete');
    }catch(err){ alert('Error importing: ' + err.message) } }
    reader.readAsText(f);
  });

  document.getElementById('btnDeleteAll').addEventListener('click',function(){
    if(!confirm('Delete all entries? This cannot be undone.')) return;
    localStorage.removeItem(KEY); render();
  });

  document.getElementById('btnToday').addEventListener('click', function(){
    document.getElementById('date').value = todayISO();
    window.scrollTo({top:0,behavior:'smooth'});
  });

  document.getElementById('btnAddSample').addEventListener('click', function(){
    const sample = {
      id: uid(),
      date: todayISO(),
      workout: 'Legs+Core',
      breakfast: 'Sprouts + egg',
      lunch: 'Sambar rice',
      snack: 'Sandwich',
      dinner: 'Roti + veg',
      protein: 82,
      walk: true,
      posture: true,
      notes: 'Sample entry',
      workoutDays: {Mon:true},
      postureImgs: {},
      calories: 850,
      waterMl: 2000,
      updatedAt: new Date().toISOString()
    };
    const cur = load(); cur.push(sample); saveAll(cur);
  });

  // ---------- STEP 2: DAILY DETAIL JS ----------

  // Create food row
  function createFoodRow(item='', g=0, kcal100=0, prot100=0){
    const tbody = document.querySelector('#foodTable tbody');
    const id = 'food_' + Math.random().toString(36).slice(2,8);
    const tr = document.createElement('tr'); tr.dataset.id = id;
    tr.innerHTML = `
      <td><input class="foodItem" value="${item}" style="width:100%;padding:6px;border-radius:6px;border:1px solid rgba(255,255,255,0.05)" /></td>
      <td><input class="foodG" type="number" value="${g}" style="width:100%;padding:6px;border-radius:6px;border:1px solid rgba(255,255,255,0.05)" /></td>
      <td><input class="foodKcal" type="number" value="${kcal100}" style="width:100%;padding:6px;border-radius:6px;border:1px solid rgba(255,255,255,0.05)"/></td>
      <td><input class="foodProt" type="number" value="${prot100}" style="width:100%;padding:6px;border-radius:6px;border:1px solid rgba(255,255,255,0.05)"/></td>
      <td><button class="secondary removeFood" type="button">Remove</button></td>
    `;
    tbody.appendChild(tr);

    // wire events
    tr.querySelectorAll('input').forEach(inp => inp.addEventListener('input', updateFoodTotals));
    tr.querySelector('.removeFood').addEventListener('click', ()=>{
      tr.remove(); updateFoodTotals();
    });
    updateFoodTotals();
  }

  document.getElementById('addFoodRow').addEventListener('click', function(e){ e.preventDefault(); createFoodRow(); });
  document.getElementById('addPreset').addEventListener('click', function(e){
    e.preventDefault();
    // presets (approx)
    createFoodRow('Cooked Rice', 150, 130, 2.7);
    createFoodRow('Boiled Moong (pesalu)', 100, 105, 7);
    createFoodRow('Egg (1 ~50g)', 50, 155, 6.3); // approximate kcal/100g ~155 for whole egg
    updateFoodTotals();
  });

  function updateFoodTotals(){
    const rows = Array.from(document.querySelectorAll('#foodTable tbody tr'));
    let totalK = 0, totalP = 0;
    rows.forEach(r=>{
      const g = Number(r.querySelector('.foodG').value || 0);
      const k100 = Number(r.querySelector('.foodKcal').value || 0);
      const p100 = Number(r.querySelector('.foodProt').value || 0);
      totalK += (g/100) * k100;
      totalP += (g/100) * p100;
    });
    document.getElementById('totKcal').textContent = Math.round(totalK);
    document.getElementById('totProt').textContent = Math.round(totalP);
    return { kcal: totalK, prot: totalP };
  }

  // Quick-workout day toggles
  ['Mon','Tue','Wed','Thu','Fri','Sat'].forEach(d=>{
    const btn = document.getElementById('day'+d);
    btn.addEventListener('click', function(){
      const today = todayISO();
      const items = load();
      let entry = items.find(x=> x.date === today);
      if(!entry){ entry = { id: uid(), date: today, workoutDays: {}, protein:0, walk:false, posture:false, notes:'', updatedAt: new Date().toISOString() }; items.push(entry); }
      entry.workoutDays = entry.workoutDays || {};
      entry.workoutDays[d] = !entry.workoutDays[d];
      saveAll(items);
      // toggle ui style (apply accentOn)
      btn.classList.toggle('accentOn', !!entry.workoutDays[d]);
      render();
    });
  });

  // Posture image upload
  function readFileToDataUrl(input, slot){
    const f = input.files && input.files[0];
    if(!f) return;
    if(f.size > 500 * 1024){ alert('Image too large. Use <500KB'); return; }
    const reader = new FileReader();
    reader.onload = function(ev){
      const dataUrl = ev.target.result;
      const arr = load(); const today = todayISO();
      let entry = arr.find(x=>x.date===today);
      if(!entry){ entry = { id: uid(), date: today, workoutDays:{}, protein:0, walk:false, posture:false, notes:'', updatedAt:new Date().toISOString() }; arr.push(entry); }
      entry.postureImgs = entry.postureImgs || {};
      entry.postureImgs[slot] = dataUrl;
      saveAll(arr);
      showPosturePreviews();
    };
    reader.readAsDataURL(f);
  }
  document.getElementById('postureFile1').addEventListener('change', ()=> readFileToDataUrl(document.getElementById('postureFile1'), 'a'));
  document.getElementById('postureFile2').addEventListener('change', ()=> readFileToDataUrl(document.getElementById('postureFile2'), 'b'));

  function showPosturePreviews(){
    const p = document.getElementById('posturePreview'); p.innerHTML = '';
    const arr = load(); const today = todayISO();
    const entry = arr.find(x=>x.date===today);
    if(!entry || !entry.postureImgs) return;
    ['a','b'].forEach(k=>{
      if(entry.postureImgs[k]){
        const img = document.createElement('img'); img.src = entry.postureImgs[k]; img.style.width='120px'; img.style.borderRadius='6px'; img.style.objectFit='cover';
        p.appendChild(img);
      }
    });
  }
  showPosturePreviews();

  // Evaluate day logic
  document.getElementById('btnEvaluate').addEventListener('click', function(){
    const foodTotals = updateFoodTotals();
    const water = Number(document.getElementById('waterMl').value || 0);
    const pTarget = Number(document.getElementById('proteinTarget').value || 100);
    const calMin = Number(document.getElementById('calMin').value || 1400);
    const calMax = Number(document.getElementById('calMax').value || 2200);

    // load today's saved entry
    const arr = load(); const today = todayISO();
    let entry = arr.find(x=>x.date===today);
    if(!entry){ entry = { id: uid(), date: today, workoutDays:{}, protein:0, walk:false, posture:false, notes:'', updatedAt:new Date().toISOString() }; arr.push(entry); }

    // update entry with food totals + water + protein
    entry.calories = Math.round(foodTotals.kcal);
    entry.protein = Math.round(foodTotals.prot) || (entry.protein || 0);
    entry.waterMl = water;
    saveAll(arr);

    // compute score (6 checks)
    let score = 0;
    const workoutDone = Object.values(entry.workoutDays || {}).some(Boolean);
    if(workoutDone) score++;
    if(entry.posture) score++;
    if(entry.walk) score++;
    if(entry.protein >= pTarget) score++;
    if(entry.waterMl >=  (Number(document.getElementById('waterMl').placeholder || 3000))) score++;
    if(entry.calories >= calMin && entry.calories <= calMax) score++;

    const pct = Math.round((score / 6) * 100);
    const verdict = pct >= 66 ? 'Good day ✅' : (pct >= 40 ? 'Fair — improve few things ⚠️' : 'Needs improvement ❌');

    // display result
    const out = document.getElementById('dailyResult');
    out.innerHTML = `
      <div><strong>Score:</strong> ${pct}% (${score}/6)</div>
      <div><strong>Calories:</strong> ${entry.calories} kcal (target ${calMin}-${calMax})</div>
      <div><strong>Protein:</strong> ${entry.protein} g (target ${pTarget} g)</div>
      <div><strong>Water:</strong> ${entry.waterMl} ml</div>
      <div style="margin-top:6px"><strong>Verdict:</strong> ${verdict}</div>
    `;
  });

  document.getElementById('btnSaveDaily').addEventListener('click', function(){
    document.getElementById('btnEvaluate').click();
    alert('Daily summary saved.');
  });

  // Render initially
  render();

})();
</script>
</body>
</html>
